---
title: "**Boletin Epidemiologico Municipio de Pereira**"
lang: es
header-includes:
- \usepackage{graphicx}
- \usepackage{fancyhdr}
- \pagestyle{fancy}
- \fancyhead[L]{\slshape \rightmark}
- \fancyfoot[C]{\thepage}
- \renewcommand{\headrulewidth}{0.1pt}
- \usepackage{floatpag}
- \floatpagestyle{empty}
- \setlength{\headsep}{5mm}
- \addtolength{\headheight}{1.3cm}
- \pagestyle{fancyplain}
- \lhead{\includegraphics[height=1.0cm]{municipio2020.png}}
- 
  \fancyhead[R]{
  Secretaria de Salud Pública y Seguridad Social \\ 
  Vigilancia en Salud Pública \\ 
  Semana 19 - 2025} 
geometry: "left=2cm,right=2cm,top=3cm,bottom=3cm"
output: bookdown::pdf_book
classoption:
  #- twocolumn # documento a dos columnas 
  #- landscape # posicion horizontal 
papersize: paper # tamaño del papel
linestretch: 1.0 # espacio
fontsize: 9pt # tamaño de la fuente 
latex_engine: xelatex
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readxl)
library(ggplot2)
library(RColorBrewer)
library(tidyverse)
library(rstatix)
library(googlesheets4)
library(linelist)
library(janitor)
library(gtsummary)
library(lubridate)
library(cowplot)
library(gt)
library(incidence)
library(flextable)
library(binom)
library(ggpp)
library(rio)
library(scales)
epiweek <- 19
  #lubridate::epiweek(today()-7)
canalend <- read_excel("/cloud/project/Boletin_ Epi_Pereira/Datos/canalend.xlsx")
histo <- read_excel("/cloud/project/Boletin_ Epi_Pereira/Datos/histo.xlsx")
dengue2018 <- read_excel("/cloud/project/Boletin_ Epi_Pereira/Datos/dengue2018.xlsx")
histoira<-read_csv("/cloud/project/Boletin_ Epi_Pereira/Datos/histoira.csv")
ira<-read_csv("/cloud/project/Boletin_ Epi_Pereira/Datos/ira.csv")
evento_995 <- read_excel("/cloud/project/Boletin_ Epi_Pereira/Datos/2025_995.xlsx")
evento_998 <- read_excel("/cloud/project/Boletin_ Epi_Pereira/Datos/2025_998.xlsx")
#evento_346 <- read_excel("/cloud/project/Boletin_ Epi_Pereira/Datos/db346.xlsx") 
#evento_346 <- evento_346 %>% filter(ajuste_=="0" | ajuste_=="3" | ajuste_=="4" | ajuste_=="5" | ajuste_=="7", nmun_proce == "PEREIRA", semana <= 5)   #### CAMBIAR CADA SEMANA 

varicela <- read_excel("/cloud/project/Boletin_ Epi_Pereira/Datos/2025_831_Reporte.xlsx")
c_viral <- readRDS("/cloud/project/Boletin_ Epi_Pereira/Datos/c_viral.rds")
filmarray <- read_sheet("https://docs.google.com/spreadsheets/d/1W9bwlXzatRVZKkwsaVo2i91fs_RcpSAQ77Ks99ykyRc/edit#gid=1910681332", sheet = "Muestras2023") %>% 
  mutate(`N IDENTIFICACION` = as.character(`N IDENTIFICACION`))
filmarray2 <- add_case(filmarray,c_viral)
saveRDS(filmarray2,"/cloud/project/Boletin_ Epi_Pereira/Datos/filmarray2.rds")
aislamiento2 <- readRDS("/cloud/project/Boletin_ Epi_Pereira/Datos/aislamiento2.rds")
# viruela <- read_sheet("https://docs.google.com/spreadsheets/d/1KLou92VRu8r5buo6jG9DaERPpApAo1_FnN5n3SymIS0/edit#gid=966374205", sheet = "casos") %>% 
#   clean_names()
# saveRDS(viruela,"/cloud/project/Boletin_ Epi_Pereira/Datos/viruela.rds")
###################################################
######### BORRAR CUANDO SE CVERIFIQUE QUE AJUSTO EMI
#evento_995[which(evento_995$nom_upgd== "GRUPO EMI" & evento_995$semana == "34"), "tot_iraext"] <- "123"
evento_995<-evento_995 %>%
  filter(ajuste!="6") %>%
  filter(ajuste!= "D") %>%
  mutate(semana= as.numeric(semana)) %>%
  mutate(across(grupoh_1:tot_exturg, as.numeric)) %>% 
  mutate(tot_ira= tot_irag+tot_irauci+tot_iraext)  %>% filter(semana<= epiweek) # QUITAR SEMANA 
# summary statistics on grouped linelist
infe<- evento_995 %>% 
  group_by(semana) %>% 
  summarise(
    casos = sum(tot_ira),
    c_hosp = sum(tot_irag),
    c_uci = sum(tot_irauci),
    c_ext = sum(tot_iraext))
write_excel_csv(infe, file = "/cloud/project/Boletin_ Epi_Pereira/Datos/ira2018.xls")
###################################################
evento_998 <- evento_998 %>%
  filter(ajuste!="6") %>%
  filter(ajuste!= "D") %>%
  mutate(semana= as.numeric(semana)) %>%
  mutate(cas_conc= as.numeric(cas_conc))
diarreas<- evento_998 %>% 
  group_by(semana) %>% 
  summarise(
    casos = sum(cas_conc))
export(diarreas,"/cloud/project/Boletin_ Epi_Pereira/Datos/eda2018.xlsx")
###################################################
ira2018 <- read_csv("/cloud/project/Boletin_ Epi_Pereira/Datos/ira2018.xls")

eda<-read_excel("/cloud/project/Boletin_ Epi_Pereira/Datos/eda.xlsx")
eda2018<-import("/cloud/project/Boletin_ Epi_Pereira/Datos/eda2018.xlsx")
epi1<- read.csv("/cloud/project/Boletin_ Epi_Pereira/Datos/epi1.csv") %>% 
  mutate(across(everything(), as.character))
epi2<- read.csv("/cloud/project/Boletin_ Epi_Pereira/Datos/epi2.csv") %>% 
  mutate(across(everything(), as.character))
epi3<- read.csv("/cloud/project/Boletin_ Epi_Pereira/Datos/epi3.csv") %>% 
  mutate(across(everything(), as.character))

epi3 <- epi3 %>% 
  filter(as.numeric(semana)<=epiweek) %>%       
  mutate(semana = as.numeric(semana))

epi1<-epi1 %>% 
  filter(as.numeric(semana)<=epiweek) %>%  
  mutate(semana = as.numeric(semana))

epi2<-epi2 %>% 
  filter(as.numeric(semana)<=epiweek) %>%
  mutate(semana = as.numeric(semana)) %>% 
  add_row(epi3)


casos_sem<-table(epi1$cod_eve,epi1$semana)
casos_sem2<-table(epi2$cod_eve,epi2$semana)


casos2022 <- add_row(epi1, epi2)
saveRDS(casos2022,"/cloud/project/Boletin_ Epi_Pereira/Datos/casos2022.rds")

# /CirGarGen/
# /cont_jmestrada/
#PARA REVISION DE COMPORTAMIENTO INUSUAL EN IRA COLECTVA
irag <- evento_995 %>%
  group_by(cod_pre, cod_sub, nom_upgd, semana) %>%
  summarise(sum(tot_irag, na.rm = TRUE)) %>%
  ungroup() %>%
  pivot_wider(names_from = semana, values_from = `sum(tot_irag, na.rm = TRUE)`)

ira_uci <- evento_995 %>%
  group_by(cod_pre, cod_sub, nom_upgd, semana) %>%
  summarise(sum(tot_irauci, na.rm = TRUE)) %>%
  ungroup() %>%
  pivot_wider(names_from = semana, values_from = `sum(tot_irauci, na.rm = TRUE)`)

iraext <- evento_995 %>%
  group_by(cod_pre, cod_sub, nom_upgd, semana) %>%
  summarise(sum(tot_iraext, na.rm = TRUE)) %>%
  ungroup() %>%
  pivot_wider(names_from = semana, values_from = `sum(tot_iraext, na.rm = TRUE)`)

export(irag,"/cloud/project/Boletin_ Epi_Pereira/Datos/revision_IRAhospital_semanal.xlsx")
export(ira_uci,"/cloud/project/Boletin_ Epi_Pereira/Datos/revision_IRAUci_semanal.xlsx")
export(iraext,"/cloud/project/Boletin_ Epi_Pereira/Datos/revision_IRAExt_semanal.xlsx")
```

# Eventos Trazadores

## Infección respiratoria aguda {style="color:black"}

```{r, echo=FALSE}
infecciones <- sum(evento_995$tot_irag)+sum(evento_995$tot_irauci)+sum(evento_995$tot_iraext)
consultas<-sum(evento_995$tot_exturg)+sum(evento_995$tot_cau_h)+sum(evento_995$tot_h_uci) 
```

A semana epidemiológica `r ncol(casos_sem)` de 2025 se notificaron un total entre consultas externa/urgencias hospitalizaciones en sala y hospitalizaciones en UCI de `r format(consultas,scientific = F)` de las cuales el `r round(infecciones/consultas*100, digits = 2)`% (n= `r format(infecciones, scientific = F)`) corresponden a IRA. El canal endémico muestra el evento para la semana `r ncol(casos_sem)` por debajo del umbral estacional.

```{r, echo=FALSE, fig.cap= paste("Canal endémico IRA , Pereira 2025","semana epidemiologica",epiweek), fig.height=3.3, fig.width=7, fig.pos='h',}
plot(ira$semana, ira$icinftotal, type='l', ylim=c(1,4000), xlim=c(1,52), col="green",lwd=3, xlab="Semana epidemiológica", ylab="Casos", cex=0.6)
lines(ira$icsuptotal, col="red",lwd=3, cex=0.7)
abline(1633,0,1633, col="yellow", lwd=3)
lines(ira2018$casos, col="black", lwd=3, cex=0.7, type = "p")
legend(25,4000, c("IC Inf 95%","IC Sup 95%", "Umbral estacional", "casos 2025"), col=c("green","red","yellow","black"), lty = c(1,1), lwd = c(2,2), bty="n", cex=0.6)
```

En relación a la notificación segun servicio y comparando la semana notificada del actual año con la misma semana del año anterior, se identifica una disminución en en servicio de hospitalización UCI

**Tabla 1. Comportamiento de la Infección Respiratoria Aguda segun tipo de servicio, semana epidemiológica `r ncol(casos_sem)`**

| **Servicio**               |                 **a Sem `r ncol(casos_sem)`/2024**                  |                 **a Sem `r ncol(casos_sem)`/2025**                 |                                                                      **Variacion (%)**                                                                      |
|-----------------|:---------------:|:---------------:|:-------------------:|
| Hospitalización Sala | `r sum(histoira[1:ncol(casos_sem),"ira_hosp"])` | `r format(sum(ira2018[1:ncol(casos_sem),"c_hosp"]), scientific=F)` | `r round((sum(ira2018[1:ncol(casos_sem),"c_hosp"])- sum(histoira[1:ncol(casos_sem),"ira_hosp"]))/sum(histoira[1:ncol(casos_sem),"ira_hosp"])*100,digits=1)` |
| Hospitalizacion UCI        |           `r sum(histoira[1:ncol(casos_sem),"ira_uci"])`            |            `r sum(ira2018[1:ncol(casos_sem),"c_uci"])`             |  `r round((sum(ira2018[1:ncol(casos_sem),"c_uci"])- sum(histoira[1:ncol(casos_sem),"ira_uci"]))/sum(histoira[1:ncol(casos_sem),"ira_uci"])*100,digits=1)`   |
| Consulta Externa-Urgencias | `r format(sum(histoira[1:ncol(casos_sem),"ira_ext"]),scientific=F)` | `r format(sum(ira2018[1:ncol(casos_sem),"c_ext"]), scientific=F)`  |  `r round((sum(ira2018[1:ncol(casos_sem),"c_ext"])- sum(histoira[1:ncol(casos_sem),"ira_ext"]))/sum(histoira[1:ncol(casos_sem),"ira_ext"])*100,digits=1)`   |

Para la semana `r ncol(casos_sem)` la hospitalización por IRA en sala general para esta semana muestra por encima del limite superior esperado. La proporción acumulada de hospitalización por IRA es de  `r round(sum(evento_995$tot_irag)/sum(evento_995$tot_cau_h)*100,digits=2)`%.

```{r, echo=FALSE, fig.cap="Canal endémico Hospitalizaciones por IRA en sala general , Pereira 2025", fig.height=3.3, fig.width=7}
plot(ira$semana, ira$icinfhosp, type='l', ylim=c(1,170), xlim=c(1,52), col="green",lwd=3, xlab="Semana epidemiológica", ylab="Casos", cex=0.6, main = "")
lines(ira$icsuphosp, col="red",lwd=3, cex=0.7)
abline(52,0,52, col="yellow", lwd=3)
lines(ira2018$c_hosp, col="black", lwd=3, cex=0.7, type = "p")
legend(5,160, c("IC Inf 95%","IC Sup 95%", "Umbral estacional", "casos 2025"), col=c("green","red","yellow","black"), lty = c(1,1), lwd = c(2,2), bty="n", cex=0.6)
```

De igual manera en el canal endémico para la notificación por IRA hospitalizados en Unidad de Cuidados Intensivos (**UCI**) (figura 3), se encuentra por encima del limite superior esperado a semana epidemiologica notificada. La proporción acumulada de hospitalizaciones por IRA en UCI alcanza un `r round(sum(evento_995$tot_irauci)/sum(evento_995$tot_h_uci)*100,digits=2)`%.

```{r, echo=FALSE, warning=FALSE}
uci_tot <- evento_995  %>% 
  filter(semana==ncol(casos_sem)) %>% 
  summarise(menor1 = sum(totuci_1),
            de1 = sum(totuci_2),
            d2a4 = sum(totuci_3),
            d5a19 = sum(totuci_4),
            d20a39 = sum(totuci_5),
            d40a59 = sum(totuci_6),
            mayor60 = sum(totuci_7)) %>% 
  pivot_longer(cols = 1:7, names_to = "edad1", values_to = "uci_tot")

evento_995  %>% 
  filter(semana==ncol(casos_sem)) %>% 
  summarise(`< 1`= sum(irauci_1),
            `1` = sum(irauci_2),
            `2 a 4` = sum(irauci_3),
            `5 a 19` = sum(irauci_4),
            `20 a 39` = sum(irauci_5),
            `40 a 59` = sum(irauci_6),
            `mayor e igual 60` = sum(irauci_7)) %>% 
  pivot_longer(cols = 1:7, names_to = "edad", values_to = "uci_ira") %>% 
  add_column(uci_tot[,2]) %>% 
  mutate(porcentaje = round(uci_ira/uci_tot*100,digits=1)) %>% 
  flextable::flextable() %>% 
  flextable::autofit() %>% 
  flextable::set_header_labels(
      edad = "Edad (años)", 
      uci_ira = "Hosp. UCI IRA",                  
      uci_tot = "Hosp. UCI todas las causas",
      porcentaje = "% de Hosp. UCI") %>% 
  flextable::bg(j = 4, i = ~ porcentaje>= 15, part = "body", bg = "orange") %>% 
  flextable::align(j = c(2:4), align = "center", part = "all" )
```


```{r, echo=FALSE, fig.cap="Canal endémico Hospitalizaciones por IRA en UCI , Pereira 2025", fig.height=3.3, fig.width=7}
plot(ira$semana, ira$icinfuci, type='l', ylim=c(0,20), xlim=c(1,52), col="green",lwd=3, xlab="Semana epidemiológica", ylab="Casos", cex=0.6, main = "")
lines(ira$icsupuci, col="red",lwd=3, cex=0.7)
abline(5,0,5, col="yellow", lwd=3)
lines(ira2018$c_uci, col="black", lwd=3, cex=0.7, type = "p")
legend(30,20, c("IC Inf 95%","IC Sup 95%", "Umbral estacional", "2025"), col=c("green","red","yellow","black"), lty = c(1,1), lwd = c(2,2), bty="n", cex=0.5)
```

Por grupo de edad en la hospitalizaciones por IRA, la mayor concentración de hospitalizaciones a causa de infección respiratoria es en el grupo de edad menores a un año y el grupo de 1 año y menores a 1 año de edad.

```{r, warning=FALSE, echo=FALSE}
hosp_tot <- evento_995  %>% 
  filter(semana==ncol(casos_sem)) %>% 
  summarise(menor1 = sum(hospital_1),
            de1 = sum(hospital_2),
            d2a4 = sum(hospital_3),
            d5a19 = sum(hospital_4),
            d20a39 = sum(hospital_5),
            d40a59 = sum(hospital_6),
            mayor60 = sum(hospital_7)) %>% 
  pivot_longer(cols = 1:7, names_to = "edad1", values_to = "hosp_tot")

evento_995  %>% 
  filter(semana==ncol(casos_sem)) %>% 
  summarise(`< 1`= sum(grupoh_1),
            `1` = sum(grupoh_2),
            `2 a 4` = sum(grupoh_3),
            `5 a 19` = sum(grupoh_4),
            `20 a 39` = sum(grupoh_5),
            `40 a 59` = sum(grupoh_6),
            `mayor e igual 60` = sum(grupoh_7)) %>% 
  pivot_longer(cols = 1:7, names_to = "edad", values_to = "hosp_ira") %>% 
  add_column(hosp_tot[,2]) %>% 
  mutate(porcentaje = round(hosp_ira/hosp_tot*100,digits=1)) %>% 
  flextable::flextable() %>% 
  flextable::autofit() %>% 
  flextable::set_header_labels(
      edad = "Edad (años)", 
      hosp_ira = "Hospitalizaciones IRA",                  
      hosp_tot = "Hospitalizacion todas las causa",
      porcentaje = "% de Hospitalizaciones") %>% 
  flextable::bg(bg = scales::col_numeric(palette = c("wheat", "red"), domain = c(0, 100), alpha = 0.5),
                j = 4) %>% 
  flextable::align(j = c(2:4), align = "center", part = "all")
```

En consulta externa y urgencias se han reportado de manera acumulada `r format(sum(evento_995$tot_exturg), scientific = F)` de consultas, donde las consultas por infección respiratoria aguda ocupan el `r round(sum(evento_995$iraext)/sum(evento_995$tot_exturg)*100,digits=3)`%. 

```{r, echo=FALSE, fig.cap="Canal endémico consulta externa y urgencias por IRA, Pereira 2025", fig.height=3.3, fig.width=7}
plot(ira$semana, ira$icinfext, type='l', ylim=c(1,4000), xlim=c(1,52), col="green",lwd=3, xlab="Semana epidemiológica", ylab="Casos", cex=0.6, main = "")
lines(ira$icsupext, col="red",lwd=3, cex=0.7)
abline(1504,0,1504, col="yellow", lwd=3)
lines(ira2018$c_ext, col="black", lwd=3, cex=0.7, type = "p")
legend(25,3800, c("IC Inf 95%","IC Sup 95%", "Umbral estacional", "2025"), col=c("green","red","yellow","black"), lty = c(1,1), lwd = c(2,2), bty="n", cex=0.6)
```

En cuanto a la edad, en las consultas por IRA en servicio de consulta externa y urgencias, la proporción de consultas por IRA en cada grupo de edad se observa una concentración del mas de 10% en los de un año. El canal endemico general para IRA se encuentra alcanzando el nivel esperado superior para esta semana epidemiologica.

```{r, echo=FALSE, warning=FALSE}
con_tot <- evento_995  %>% 
  filter(semana==ncol(casos_sem)) %>% 
  summarise(menor1 = sum(totcext_1),
            de1 = sum(totcext_2),
            d2a4 = sum(totcext_3),
            d5a19 = sum(totcext_4),
            d20a39 = sum(totcext_5),
            d40a59 = sum(totcext_6),
            mayor60 = sum(totcext_7)) %>% 
  pivot_longer(cols = 1:7, names_to = "edad1", values_to = "consultas_tot")

evento_995  %>% 
  filter(semana==ncol(casos_sem)) %>% 
  summarise(`< 1`= sum(iracext_1),
            `1` = sum(iracext_2),
            `2 a 4` = sum(iracext_3),
            `5 a 19` = sum(iracext_4),
            `20 a 39` = sum(iracext_5),
            `40 a 59` = sum(iracext_6),
            `mayor e igual 60` = sum(iracext_7)) %>% 
  pivot_longer(cols = 1:7, names_to = "edad", values_to = "consultas_ira") %>% 
  add_column(con_tot[,2]) %>% 
  mutate(porcentaje = round(consultas_ira/consultas_tot*100,digits=1)) %>% 
  flextable::flextable() %>% 
  flextable::autofit() %>% 
  flextable::set_header_labels(
      edad = "Edad (años)", 
      consultas_ira = "Consultas IRA",                  
      consultas_tot = "Consulta todas las causa",
      porcentaje = "% de Consultas") %>% 
  flextable::bg(j = 4, i = ~ porcentaje>= 15, part = "body", bg = "red") %>% 
  flextable::align(j = c(2:4), align = "center", part = "all" )
```

## Circulación virus respiratorios

```{r, echo=FALSE, warning=FALSE}
filmarray2 <- filmarray2 %>% 
  mutate(fec_muestra = ymd(FECHA))

filmarray2 <- filmarray2 %>% 
  mutate(resultado = case_when(RESULTADO == "NONE"~"Negativo",
                               RESULTADO != "NONE"~"Positivo")) %>% 
  mutate(semana = epiweek(fec_muestra))

############ creacion de denominador para incidencia de semana en la circulacion viral
denom_semanal <- filmarray2 %>% 
  filter(year(fec_muestra) == 2025) %>%
  mutate(resultado = case_when(RESULTADO == "NONE"~"Negativo",
                               RESULTADO != "NONE"~"Positivo")) %>% 
  mutate(gr_semana = case_when(semana >= max(semana)-3 & semana <= max(semana)-2 ~ str_glue("Semana {max(semana)-2} ","- ","{max(semana)-3}"),
                               semana >= max(semana)-1 ~ str_glue("Semana {max(semana)-1} ","- ","{max(semana)}"))) %>% 
  count(gr_semana) %>% 
  data.frame()

############################################
aislamientos <- filmarray %>% 
  filter(RESULTADO != "NONE") %>% 
  separate(col = RESULTADO, into = c("m1","m2","m3","m4","m5","m6"), sep = ",")

aislamiento <- aislamientos %>% 
  pivot_longer(cols = starts_with("m"), names_to = "microorganismo") %>% 
  filter(!is.na(value)) %>%
  mutate(value = str_squish(value)) %>% 
  add_case(aislamiento2) %>% 
  filter(year(FECHA) == 2025) %>%  # filtro de año 2024
  mutate(semana = epiweek(FECHA)) %>%  
  mutate(gr_semana = case_when(semana >= max(semana)-3 & semana <= max(semana)-2 ~ str_glue("Sem {max(semana)-2} ","- ","{max(semana)-3}"), semana >= max(semana)-1 ~ str_glue("Sem {max(semana)-1} ","- ","{max(semana)}")))

write_csv(aislamiento, "/cloud/project/Boletin_ Epi_Pereira/Datos/aislamientos_2023.csv")
  

positivo <- filmarray2 %>% 
  filter(year(FECHA) == 2025) %>%    # filtro de año de muestra
  group_by(resultado) %>% 
  summarise(n=n()) %>% 
  adorn_percentages(denominator = "col") %>% 
  adorn_pct_formatting()

microorg <- aislamiento %>% 
  group_by(value) %>% 
  summarise(n = n()) %>% 
  mutate(prop = round(n/sum(n)*100,digits = 1)) %>% 
  arrange(desc(n))

m_ips <- filmarray2 %>% 
                filter(year(fec_muestra) == 2025) %>% 
                group_by(IPS) %>% 
                count() %>% 
                rename("Muestras (n)"= "n") %>% 
  ungroup() %>% 
   mutate(`Muestras (n)`= sprintf("%.0f", `Muestras (n)`)) 


df <- tibble(x = 20, y = 1, m_ips = list(m_ips))
```


```{r, echo=FALSE, warning=FALSE, fig.height=2.5 , fig.width=7, fig.cap="Positividad muestras tracto respiratorio, Pereira 2025"}
filmarray2 %>% 
  filter(year(fec_muestra)==2025) %>% # filtra solo para 2024
  group_by(semana) %>% 
  tabyl(semana, resultado) %>% 
  adorn_percentages() %>% 
  pivot_longer(cols = c("Negativo","Positivo"), names_to = "resultado") %>% 
  ggplot(aes(x = semana, y = value, fill = resultado))+ geom_col()+
  scale_x_continuous(limits = c(0,53), breaks = seq(1,52,1))+
  labs(x = "Semana epidemiologica",
       y = "Proporción",
       fill = "Resultado")+
   geom_table(data = df ,
               aes(x = x , y = y, label = m_ips), size = 1.5)+
  theme_classic()+
  theme(legend.position = "top", 
        axis.text.x = element_text(size = 6), 
        legend.text = element_text(size = 7), 
        legend.title = element_text(size = 8),
        axis.title.x = element_text(size = 9),
        axis.title.y = element_text(size = 9))+
  scale_fill_manual(values = c("#5189C1","#95CFA5"))
```

A periodo epidemiologico 5 de 2025 `r nrow(filmarray2 %>% filter(year(FECHA)==2024)) ` muestras en el municipio, con aislamientos tanto virales como bacterianos con una positividad acumulada de `r positivo[2,2] `  y una  positividad semanal como lo muestra la **figura 5**. La incidencia de microorganismos en aislamientos virales procesado por FilmArray para el año en curso.

```{r tabla para incidencia viral semanal, echo=FALSE, warning=FALSE}
epi_viral <- aislamiento %>% 
  filter(year(FECHA) == 2025) %>%  # filtro de año 
  mutate(viral = case_when(value == "Enterovirus" ~ "Enterovirus",
                           value == "enterovirus" ~ "Enterovirus",
                           str_detect(value,pattern = regex("enterovirus humano", ignore_case = TRUE)) == TRUE ~ "Enterovirus",
                           value == "Rhinovirus"~ "Rhinovirus",
                           value == "Rinovirus"~ "Rhinovirus",
                           value == "Human Rhinovirus/Enterovirus"~"Rhinovirus",
                           str_detect(value,patter = regex("Human rhinovirus", ignore_case = TRUE)) == TRUE~"Rhinovirus",
                           value == "Rinovirus/Enterovirus Humano"~"Rhinovirus",
                           value == "metaneumovirus" ~ "metaneumovirus",
                           value == "Metaneumovirus" ~ "metaneumovirus",
                           value == "Metapneumovirus" ~ "metaneumovirus",
                           value == "metapneumovirus"~ "metaneumovirus",
                           value == "Human metapneumovirus"~ "metaneumovirus",
                           value == "Human Metapneumovirus"~ "metaneumovirus",
                           value == "Influenza A/H1-2009"~ "Influenza AH1N1",
                           value == "Influenza A H1-2009"~"Influenza AH1N1",
                           value == "Influenza A H1 – 2009"~"Influenza AH1N1",
                           value == "Adenovirus" ~ "Adenovirus",
                           value == "Influenza A" ~ "Influenza A",
                           str_detect(value, regex("Influenza A H3|Influenza A-H3", ignore_case=TRUE)) == TRUE ~ "Influenza A",
                           value == "Respiratory Syncytial Virus"~ "VSR",
                           value == "Virus Sincitial Respiratorio"~ "VSR",
                           value == "Virus Syncitial Respiratorio"~ "VSR",
                           value == "Respiratory syncytial virus"~ "VSR",
                           value == "SARS-CoV-2" | value == "Sars Cov -2"~"SARS-CoV-2", 
                           value == "Coronavirus SARS Cov 2"~"SARS-CoV-2",
                           str_detect(value,regex("influenza B", ignore_case = TRUE)) == TRUE ~"Influenza B",
                           str_detect(value,regex("Parainfluenza( virus( [1-4])?)?", ignore_case = TRUE)) == TRUE~"Parainfluenza Virus (1,2,3)",
                           str_detect(value, pattern = regex("Coronavirus\\sN\\w*|Coronavirus")) == TRUE ~ "Coronavirus")) %>% 
  filter(is.na(viral)==FALSE) %>% 
  count(viral, gr_semana) %>% 
  filter(!is.na(gr_semana)) %>% 
  pivot_wider(id_cols = viral, names_from = gr_semana, values_from = n, values_fill = 0)
```


\newpage

```{r, echo=FALSE, message=FALSE, warning=FALSE}
aislamiento %>% 
  filter(year(FECHA) == 2025) %>%   # filtro de año para 2025
  mutate(viral = case_when(value == "Enterovirus" ~ "Enterovirus",
                           value == "enterovirus" ~ "Enterovirus",
                           str_detect(value,pattern = regex("enterovirus humano", ignore_case = TRUE)) == TRUE ~ "Enterovirus",
                           value == "Rhinovirus"~ "Rhinovirus",
                           value == "Rinovirus"~ "Rhinovirus",
                           value == "Human Rhinovirus/Enterovirus"~"Rhinovirus",
                           str_detect(value,patter = regex("Human rhinovirus", ignore_case = TRUE)) == TRUE~"Rhinovirus",
                           value == "Rinovirus/Enterovirus Humano"~"Rhinovirus",
                           value == "metaneumovirus" ~ "metaneumovirus",
                           value == "Metaneumovirus" ~ "metaneumovirus",
                           value == "Metapneumovirus" ~ "metaneumovirus",
                           value == "metapneumovirus"~ "metaneumovirus",
                           value == "Human metapneumovirus"~ "metaneumovirus",
                           value == "Human Metapneumovirus"~ "metaneumovirus",
                           value == "Influenza A/H1-2009"~ "Influenza AH1N1",
                           value == "Influenza A H1-2009"~"Influenza AH1N1",
                           value == "Influenza A H1 – 2009"~"Influenza AH1N1",
                           value == "Adenovirus" ~ "Adenovirus",
                           value == "Influenza A" ~ "Influenza A",
                           str_detect(value, regex("Influenza A H3|Influenza A-H3", ignore_case=TRUE)) == TRUE ~ "Influenza A",
                           value == "Respiratory Syncytial Virus"~ "VSR",
                           value == "Virus Sincitial Respiratorio"~ "VSR",
                           value == "Virus Syncitial Respiratorio"~ "VSR",
                           value == "Respiratory syncytial virus"~ "VSR",
                           value == "SARS-CoV-2" | value == "Sars Cov -2"~"SARS-CoV-2", 
                           value == "Coronavirus SARS Cov 2"~"SARS-CoV-2",
                           str_detect(value,regex("influenza B", ignore_case = TRUE)) == TRUE ~"Influenza B",
                           str_detect(value,regex("Parainfluenza( virus( [1-4])?)?", ignore_case = TRUE)) == TRUE~"Parainfluenza Virus (1,2,3)",
                           str_detect(value, pattern = regex("Coronavirus\\sN\\w*|Coronavirus")) == TRUE ~ "Coronavirus")) %>%  
  filter(is.na(viral)==FALSE) %>% 
  group_by(viral) %>% 
  summarise(n = n(),
            prevalencia = round(n/nrow(filmarray2 %>% 
                                                      filter(FECHA >="2024-01-01"))*100,1),
            IC95inf = round(binom::binom.wilson(n,nrow(filmarray2 %>% 
                                                      filter(FECHA >="2024-01-01")))[,5]*100,2),
            sup = round(binom::binom.wilson(n,nrow(filmarray2%>% 
                                                      filter(FECHA >="2024-01-01")))[,6]*100,2)) %>% 
  arrange(desc(n)) %>% 
  left_join(epi_viral, by = "viral") %>% 
  mutate(across(6:7, replace_na, 0)) %>% 
  mutate(across(6,.fns = ~ round(.x/denom_semanal[1,2]*100,1))) %>% 
  mutate(across(7,.fns = ~ round(.x/denom_semanal[2,2]*100,1))) %>% 
  #filter(n>=1) %>% 
  flextable::flextable() %>% 
  #flextable::autofit() %>% 
  flextable::set_header_labels(
      viral = "Microorganismo",
      n = "Aislamientos (n)", 
      prevalencia = "Prop.Incidencia (%)",                  
      IC95inf = "IC95% inf",
      sup = "IC95% sup") %>% 
  flextable::align(j = c(2:7), align = "center", part = "all" ) %>% 
  footnote(i = 1, j = 6:7,
            value = as_paragraph(
              c("Proporción de incidencia sobre las muestras procesadas en el periodo de 2 semanas ")),
            ref_symbols = c("a"),
            part = "header") %>% 
  fontsize(size = 9, part = "all") %>% 
  width(j = 1:3, width = 1)
```

```{r, echo=FALSE, message=FALSE, warning=FALSE, eval=FALSE}
# `r microorg[microorg$value=="Rhinovirus",3]`% de los aislamientos (n= `r  microorg[microorg$value=="Rhinovirus",2]`), seguido por Enterovirus con `r microorg[microorg$value=="Enterovirus",3]`% (n= `r  microorg[microorg$value=="Enterovirus",2]`) y Adenovirus `r microorg[microorg$value=="Adenovirus",3]`% (n= `r  microorg[microorg$value=="Adenovirus",2]`) (**Figura 6**). Aislamientos de inlfuenza surgen en las ultimas tres semanas epidemiologicas, lo que podria tener una responsabilidad importante en el incrmento en la hospitalizacion en IRA en sala general, especialmente en menores de 4 años.

```

Durante el periodo analizado, el microorganismo con mayor proporción de incidencia fue Enterovirus, con una frecuencia de 8.2% (IC95%: 6.52–10.19), seguido por Rhinovirus con 7.2% (IC95%: 5.68–9.17) y Parainfluenza virus (1,2,3) con 3.0% (IC95%: 2.08–4.41). Otros virus detectados con menor frecuencia fueron Influenza A con 2.3% (IC95%: 1.52–3.58), Coronavirus con 1.9% (IC95%: 1.15–3.01), y Adenovirus, Influenza B y Metaneumovirus, cada uno con 1.3% (IC95%: 0.72–2.28).

El Virus Sincitial Respiratorio (VSR) presentó una proporción de 1.2% (IC95%: 0.64–2.13), mientras que SARS-CoV-2 fue el microorganismo con menor incidencia registrada, con 0.4% (IC95%: 0.12–1.02).

En cuanto a la dinámica por semanas epidemiológicas (comparando semanas 15a–16 con semanas 17–18a), se observaron cambios relevantes en la circulación viral. Enterovirus se mantuvo con una circulación elevada, pasando de 17.4% a 21.4%. Rhinovirus mostró una ligera disminución, de 26.1% a 21.4%, aunque continuó siendo uno de los virus predominantes.

Se evidenció también un aumento en la circulación de Parainfluenza virus (1,2,3) (de 8.7% a 14.3%), mientras que Influenza A y Coronavirus mostraron una disminución en su frecuencia, ambas bajando de 13.0% a 7.1%. Metaneumovirus se mantuvo relativamente estable (de 8.7% a 7.1%).

Por otro lado, virus como Adenovirus, VSR, Influenza B y SARS-CoV-2 no se detectaron en la semana 17–18a, a pesar de haberse identificado en semanas previas.

Estas variaciones podrían estar relacionadas con la dinámica estacional de los virus respiratorios y posibles interacciones virales que condicionan su comportamiento epidemiológico.

\newpage
Las estimaciones presentadas corresponden a muestras recolectadas en pacientes consultantes a servicios de urgencias y hospitalizados, lo cual puede ser un reflejo de una circulación viral entre pacientes que requieren hospitalización y que dicho panel es realizado con el fin de guiar el manejo de terapia antibiotica y pueden no reflejar la circualción de microorganismos en población general no consultante.


```{r, echo=FALSE, warning=FALSE, fig.height=2.5 , fig.width=7, fig.cap="Circulación virus respiratorios, Pereira 2025"}
aislamiento %>% 
  mutate(viral = case_when(value == "Enterovirus" ~ "Enterovirus",
                           value == "enterovirus" ~ "Enterovirus",
                           str_detect(value,pattern = regex("enterovirus humano", ignore_case = TRUE)) == TRUE ~ "Enterovirus",
                           value == "Rhinovirus"~ "Rhinovirus",
                           value == "Rinovirus"~ "Rhinovirus",
                           value == "Human Rhinovirus/Enterovirus"~"Rhinovirus",
                           str_detect(value,patter = regex("Human rhinovirus", ignore_case = TRUE)) == TRUE~"Rhinovirus",
                           value == "Rinovirus/Enterovirus Humano"~"Rhinovirus",
                           value == "metaneumovirus" ~ "metaneumovirus",
                           value == "Metaneumovirus" ~ "metaneumovirus",
                           value == "Metapneumovirus" ~ "metaneumovirus",
                           value == "metapneumovirus"~ "metaneumovirus",
                           value == "Human metapneumovirus"~ "metaneumovirus",
                           value == "Human Metapneumovirus"~ "metaneumovirus",
                           value == "Influenza A/H1-2009"~ "Influenza AH1N1",
                           value == "Influenza A H1-2009"~"Influenza AH1N1",
                           value == "Influenza A H1 – 2009"~"Influenza AH1N1",
                           value == "Adenovirus" ~ "Adenovirus",
                           value == "Influenza A" ~ "Influenza A",
                           str_detect(value, regex("Influenza A H3|Influenza A-H3", ignore_case=TRUE)) == TRUE ~ "Influenza A",
                           value == "Respiratory Syncytial Virus"~ "VSR",
                           value == "Virus Sincitial Respiratorio"~ "VSR",
                           value == "Virus Syncitial Respiratorio"~ "VSR",
                           value == "Respiratory syncytial virus"~ "VSR",
                           value == "SARS-CoV-2" | value == "Sars Cov -2"~"SARS-CoV-2", 
                           value == "Coronavirus SARS Cov 2"~"SARS-CoV-2",
                           str_detect(value,regex("influenza B", ignore_case = TRUE)) == TRUE ~"Influenza B",
                           str_detect(value,regex("Parainfluenza( virus( [1-4])?)?", ignore_case = TRUE)) == TRUE~"Parainfluenza Virus (1,2,3)",
                           str_detect(value, pattern = regex("Coronavirus\\sN\\w*|Coronavirus")) == TRUE ~ "Coronavirus")) %>%
  replace_na(list(viral = "Otras")) %>% 
  filter(year(FECHA) == 2025) %>% # filtra AÑO
  group_by(semana, viral) %>% 
  summarise(Aislamientos = n(), .groups = "keep") %>% 
  ggplot(aes(x = semana, y = Aislamientos,
             fill = factor(viral, levels = c("Otras","Adenovirus","Enterovirus","Rhinovirus", "VSR","Influenza B","SARS-CoV-2","metaneumovirus","Parainfluenza Virus (1,2,3)", "Influenza AH1N1", "Influenza A"))))+
           geom_col()+
           scale_x_continuous(limits = c(0,53), breaks = seq(1,52,1))+
           labs(x = "Semana epidemiologica", y = "Aislamientos (n)")+
  theme_classic()+
    theme(legend.title = element_blank(), 
          legend.position = "bottom", 
          axis.text.x = element_text(size=6,face = "bold"), 
          legend.text = element_text(size = 6),
          axis.title.x = element_text(size = 9),
          axis.title.y = element_text(size = 9))+
  scale_fill_manual(values = c("#A6C7F0",
                               "#95CFA5",
                               "#4BA52F",
                               "#E43149",
                               "#A600F0",
                               "#5FA1D4",
                               "#9767BB",
                               "#EC702D",
                               "#4174AD",
                               "#6DBFBE",
                               "#ED70C3"))
```

## Enfermedades transmitidas por vectores

Para las diferentes enfermedades transmitidas por vectores el reporte de casos para esta semana y su acumulado se presentan en la siguiente tabla:

```{r, echo=FALSE, fig.height=3, fig.width=7, fig.cap="Canal endémico Dengue, Pereira 2025"}
ajuste <- casos_sem2['210',(length(casos_sem2['210',])-4):(length(casos_sem2['210',])-1)]
p <- data.frame(t = as.numeric(names(ajuste)),ajuste)
model <- glm(ajuste~t, family = "poisson", data = p)
valor <- predict.glm(model, newdata = data.frame(t= c(17)),type = "response") #cambiar a cada semana
plot(canalend$semana, canalend$p25, type='l', ylim=c(0,46), xlim=c(1,52), col="green",lwd=2, xlab="Semana epidemiológica", ylab="Casos", cex=0.6, main = "")
lines(canalend$p75, col="red",lwd=2, cex=0.7)
lines(canalend$p50, col="yellow",lwd=2, cex=0.7)
lines(casos_sem2['210',], col="black",lwd=2, cex=0.7, type = "p")
lines(x = 19, y = valor, col = "blue", type = "p", lwd=4, pch = 18) # ajuste por rezago en la notificaicon por media movil de los ultimas 5 semanas
legend(1,240, c("IC inf 95%","Media", "IC sup 95%", "2025","Ajuste por rezago"), col=c("green","yellow","red","black","blue"), lty = c(1,1,1,1,1), lwd = c(1,1), bty="n", cex=0.6)
```

**Tabla 2. Comportamiento de la enfermedades transmitidas por vectores, semana epidemiológica `r ncol(casos_sem)`**

| **Evento**  |           **Semana actual**            |                  **Acumulado**                   |
|----------------------|:------------------------:|:----------------------:|
| Dengue      | `r casos_sem2["210",ncol(casos_sem2)]` | `r sum(casos_sem2[c("210"),1:ncol(casos_sem2)])` |
| Chinkunguya |                   0                    |                        0                         |
| Zika        |                   0                    |                        0                         |
| Malaria     | `r casos_sem2["465",ncol(casos_sem2)]` | `r sum(casos_sem2[c("465"),1:ncol(casos_sem2)])` |

según canal endémico (figura 5) el evento dengue se mantiene en zona de brote para el año actual.

## Infección Diarreica Aguda

```{r, echo=FALSE, fig.height=3, fig.width=7}
plot(eda$semana, eda$exito, type='l', ylim=c(0,1500), xlim=c(1,52), col="green",lwd=2, xlab="Semana epidemiológica", ylab="Casos", cex=0.7, main = "")
lines(eda$alerta, col="red",lwd=2, cex=0.7)
abline(683,0,683, col="yellow", lwd=3)
lines(eda2018$semana,eda2018$casos, col="black",lwd=2, cex=0.7)
legend(25,1400, c("IC inf 95%","Media", "IC sup 95%", "2025"), col=c("green","yellow","red","black"), lty = c(1,1), lwd = c(1,1), bty="n", cex=0.5)
```


# Eventos de interes en salud pública

## Mortalidad materno-perinatal

En la semana epidemiológica `r ncol(casos_sem)` de 2025 se notificaron `r casos_sem["560",ncol(casos_sem)]` muertes perinatales; `r sum(casos_sem["560",1:ncol(casos_sem)])` casos acumulados hasta el momento.

## Agresiones por animales potencialmente transmisores de rabia

En la semana epidemiológica `r ncol(casos_sem)` de 2025 se notificaron al Sivigila `r casos_sem2["300",ncol(casos_sem2)]` casos de agresiones por animales potencialmente transmisores de rabia , con un acumulado hasta el momento de `r sum(casos_sem2["300",1:ncol(casos_sem2)])` casos.

## Tuberculosis

Se notificaron al sistema de vigilancia para esta semana `r casos_sem2["813",ncol(casos_sem2)]` casos de tuberculosis sensible, con un acumulado en el sivigila de `r sum(casos_sem2["813",1:ncol(casos_sem2)])` casos para TB sensible.

## VIH/SIDA

Se han notificado `r casos_sem2["850",ncol(casos_sem2)]` casos de VIH/SIDA, con un acumulado en el sivigila de `r sum(casos_sem2["850",1:ncol(casos_sem2)])` casos.

## Sìfilis gestacional y congénita

Para esta semana se notificaron al Sivigila `r casos_sem["750", ncol(casos_sem)]` casos de sífilis gestacional, con un acumulado al momento de `r sum(casos_sem["750", 1:ncol(casos_sem)]) ` y casos de sífilis congénita para esta semana se han notificado `r casos_sem["740", ncol(casos_sem)]` casos,  con un acumulado de `r sum(casos_sem["750", 1:ncol(casos_sem)]) `.

## Cáncer

Entre los tipos de cáncer objeto de vigilancia en salud pública se encuentra cáncer de mama y cuello uterino. De este evento esta semana se notificaron `r casos_sem["155", ncol(casos_sem)]`  casos, con un acumulado hasta el momento de `r sum(casos_sem["155",1:ncol(casos_sem)])` casos . En Cáncer en menor de 18 años se han notificado al momento  `r sum(casos_sem["115",1:ncol(casos_sem)])`

## Defectos congénitos

Para esta semana epidemiológica `r ncol(casos_sem)` de 2025 se notificaron al sistema de vigilancia `r casos_sem["215", ncol(casos_sem)]` casos de defecto congénito. El total de casos ingresados hasta el momento son: `r sum(casos_sem["215",1:ncol(casos_sem)])` casos para defectos congénitos.

## Inmunoprevenibles

Frente al evento varicela, para esta semana epidemiológica se notificaron `r casos_sem["831", ncol(casos_sem)]` casos, con un acumulado de hasta el momento de `r sum(casos_sem["831",1:ncol(casos_sem)])`.

## Virus nuevo (COVID-19)

```{r,echo=FALSE, warning=FALSE}
covid <- casos2022 %>% filter(cod_eve == "346") %>% group_by(tip_cas_) %>% count()
```

Durante este año 2025, se han notificado a semana epidemiologica `r ncol(casos_sem)` al sistema de vigilancia SIVIGILA un total de `r covid[which(covid$tip_cas_=="3"),"n"]` casos leves o sin necesidad de hospitalización, para esta ultima semana epidemiologica no hay reporte de casos para COVID leve.

```{r, echo=FALSE, warning=FALSE, fig.height=2 , fig.width=5.5, fig.cap="Notificacion semanal COVID-19, Pereira 2025"}
ggplot(casos2022 %>% filter(cod_eve == "346"))+
  geom_bar(aes(x=as.numeric(semana)), fill = "#70BEBD" ,position = "dodge")+ theme_classic()+
  xlab("Semana/epidemiologica")+
  ylab("Casos notificados")+
  scale_x_continuous(limits = c(0,52), breaks = seq(1,52,1))+
  labs(fill = "Tipo de caso")+
  scale_fill_hue(labels = c("Confirmado"))+
  theme(legend.position = c(0.3,0.6), text = element_text(size=9), axis.text.x = element_text(size = 5))

```

# Vigilancia  de exantematica

## Vigilancia Varicela en distintos grupos poblacionales

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.height= 4, fig.width= 4,fig.cap="Comportamiento de varicela para Hombres por grupos de edad, Pereira 2025"}
####################################################################################################
varicela <- varicela %>% mutate(gr_edad = case_when(uni_med_>=2 ~ "0-9",
                                             uni_med_ == 1 & edad_< 10 ~ "0-9",
                                             uni_med_ == 1 & edad_>=10 & edad_<20 ~ "10 a 19",
                                             uni_med_ == 1 & edad_>=20 & edad_<=40 ~ "20 a 40",
                                             uni_med_ == 1 & edad_>40 ~ "Mayores a 40")) %>%
  group_by(semana, sexo_, gr_edad) %>% count(semana, name = "casos") %>% 
  mutate(semana = as.numeric(semana))

varicela_ajus <- expand.grid(semana = 1:epiweek, sexo_=c("F","M"), gr_edad=c("0-9","10 a 19","20 a 40","Mayores a 40"))

varicela_ajus <- varicela_ajus %>% left_join(varicela, by=c("semana","sexo_","gr_edad")) %>%
  replace_na(list(casos = 0))

## 0 a 9 años 
#
m1 <- ggplot(varicela_ajus %>% 
         filter(sexo_=="M" & gr_edad=="0-9"), aes(x = as.numeric(semana), y = casos))+
  geom_abline(intercept = 1, slope = 0, color = "green", size = 1)+
  geom_abline(intercept = 7, slope = 0, color = "red", size = 1)+
  geom_abline(intercept = 2, slope = 0, color = "yellow", size = 1)+
  geom_point(size = 1)+
  coord_cartesian(xlim = c(1,52), y = c(0,10))+
  labs(x= "Semana epidemiologica", y = "Casos", title = " Hombres", subtitle = "0 a 9 años")+
  theme_linedraw()+
  theme(text =  element_text(size = 8))
## 10 a 19 años 
m2 <- ggplot(varicela_ajus %>% 
         filter(sexo_=="M" & gr_edad=="10 a 19"), aes(x = as.numeric(semana), y = casos))+
  geom_abline(intercept = 1, slope = 0, color = "green", size = 1)+
  geom_abline(intercept = 5, slope = 0, color = "red", size = 1)+
  geom_abline(intercept = 2, slope = 0, color = "yellow", size = 1)+
  geom_point(size = 1)+
  coord_cartesian(xlim = c(1,52), y = c(0,10))+
  labs(x= "Semana epidemiologica", y = "Casos", title = "10 a 19 años")+
  theme_linedraw()+
  theme(text =  element_text(size = 8))

# de 20 a 40 años
m3 <- ggplot(varicela_ajus %>% 
         filter(sexo_=="M" & gr_edad=="20 a 40"), aes(x = semana, y = casos))+
  geom_abline(intercept = 1, slope = 0, color = "green", size = 1)+
  geom_abline(intercept = 7, slope = 0, color = "red", size = 1)+
  geom_abline(intercept = 2, slope = 0, color = "yellow", size = 1)+
  geom_point(size = 1)+
  coord_cartesian(xlim = c(1,52), y = c(0,10))+
  labs(x= "Semana epidemiologica", y = "Casos", title = "20 a 40 años")+
  theme_linedraw()+
  theme(text =  element_text(size = 8))

## mayores a 40 años 
m4 <- ggplot(varicela_ajus %>% 
         filter(sexo_=="M" & gr_edad=="Mayores a 40"), aes(x = semana, y = casos))+
  geom_abline(intercept = 1, slope = 0, color = "green", size = 1)+
  geom_abline(intercept = 6, slope = 0, color = "red", size = 1)+
  geom_abline(intercept = 2, slope = 0, color = "yellow", size = 1)+
  geom_point(size = 1)+
  coord_cartesian(xlim = c(1,52), y = c(0,10))+
  labs(x= "Semana epidemiologica", y = "Casos", title = "40 y mas años")+
  theme_linedraw()+
  theme(text =  element_text(size = 8))

plot_grid(m1,m2,m3,m4, align = "hv")
```

Ante la emergencia en salud publica internacional declarada por OMS por brote multi-pais por viruela simica, se realiza vigilancia de comportamientos inusuales para varicela en diferentes grupos de edad y sexo, en este sentido para semana epidemiologica  `r ncol(casos_sem)` no se presentan comportamientos fuera de lo esperado para ningun grupo de edad o sexo.

```{r, echo=FALSE, warning=FALSE, message=FALSE,fig.height= 4, fig.width= 4 ,fig.cap="Comportamiento de varicela para Mujeres por grupos de edad, Pereira 2025"}
m11 <- ggplot(varicela_ajus %>% 
         filter(sexo_=="F" & gr_edad=="0-9"), aes(x = as.numeric(semana), y = casos))+
  geom_abline(intercept = 1, slope = 0, color = "green", size = 1)+
  geom_abline(intercept = 7, slope = 0, color = "red", size = 1)+
  geom_abline(intercept = 2, slope = 0, color = "yellow", size = 1)+
  geom_point(size = 1)+
  coord_cartesian(xlim = c(1,52), y = c(0,10))+
  labs(x= "Semana epidemiologica", y = "Casos", title = "Mujeres", subtitle = "0 a 9 años")+
  theme_linedraw()+
  theme(text =  element_text(size = 8))

## 10 a 19 años 
m22 <- ggplot(varicela_ajus %>% 
         filter(sexo_=="F" & gr_edad=="10 a 19"), aes(x = as.numeric(semana), y = casos))+
  geom_abline(intercept = 1, slope = 0, color = "green", size = 1)+
  geom_abline(intercept = 5, slope = 0, color = "red", size = 1)+
  geom_abline(intercept = 2, slope = 0, color = "yellow", size = 1)+
  geom_point(size = 1)+
  coord_cartesian(xlim = c(1,52), y = c(0,10))+
  labs(x= "Semana epidemiologica", y = "Casos", title = "10 a 19 años")+
  theme_linedraw()+
  theme(text =  element_text(size = 8))

# de 20 a 40 años
m33 <- ggplot(varicela_ajus %>% 
         filter(sexo_=="F" & gr_edad=="20 a 40"), aes(x = as.numeric(semana), y = casos))+
  geom_abline(intercept = 1, slope = 0, color = "green", size = 1)+
  geom_abline(intercept = 7, slope = 0, color = "red", size = 1)+
  geom_abline(intercept = 2, slope = 0, color = "yellow", size = 1)+
  geom_point(size = 1)+
  coord_cartesian(xlim = c(1,52), y = c(0,10))+
  labs(x= "Semana epidemiologica", y = "Casos", title = "20 a 40 años")+
  theme_linedraw()+
  theme(text =  element_text(size = 8))

## mayores a 40 años 
m44 <- ggplot(varicela_ajus %>% 
         filter(sexo_=="F" & gr_edad=="Mayores a 40"), aes(x = as.numeric(semana), y = casos))+
  geom_abline(intercept = 1, slope = 0, color = "green", size = 1)+
  geom_abline(intercept = 6, slope = 0, color = "red", size = 1)+
  geom_abline(intercept = 2, slope = 0, color = "yellow", size = 1)+
  geom_point(size = 1)+
  coord_cartesian(xlim = c(1,52), y = c(0,10))+
  labs(x= "Semana epidemiologica", y = "Casos", title = "40 y mas años")+
  theme_linedraw()+
  theme(text =  element_text(size = 8))

plot_grid(m11,m22,m33,m44, align = "h")
```




```{r, echo=FALSE, warning=FALSE, message=FALSE, eval=FALSE}
# brote VIRUELA 2022
# A semana epidemiologica `r ncol(casos_sem)` se han reportado `r nrow(viruela) `  alertas al sistema de vigilancia que corresponden a casos probables de los cuales se tiene confirmación en veintitres casos (n= `r table(viruela$clasificacion_final_del_caso)[2] `),  (n= `r table(viruela$clasificacion_final_del_caso)[1]`) descartado y `r table(viruela$clasificacion_final_del_caso)[3]` pendiente de resultado. Algunas de los caracteristicas demograficas de casos probables y confirmados se muestran acontinuación:
# 
# viruela %>% filter(clasificacion_final_del_caso=="POSITIVO") %>% 
#   select(edad, sexo, orientacion) %>% 
#   
#   tbl_summary(label = list(edad~"Edad",
#                            sexo~"Sexo",
#                            orientacion~"Orientación sexual"),
#               missing_text = "No reportado") %>% 
#   modify_header(label = "Variable") %>% 
#   as_tibble() %>% 
#   #gt() %>% cols_label(caso = "Caso", edad = "Edad", sexo = "Sexo", clasificacion_final_del_caso = "Clasificación") %>% 
#   #tab_header(title = "Caracteristicas demograficas de casos notificados, Pereira 2022-2023") %>% 
#   flextable() %>% 
#   flextable::autofit() %>% 
#   flextable::set_header_labels(
#       Variable = " ",
#       `**N = 38**` = "Casos") %>% 
#   flextable::align(j = c(2), align = "center", part = "all" )
# 

## curva epidemica viruela durante brote
# viruela_curva <- viruela %>% 
#   filter(clasificacion_final_del_caso!="NEGATIVO")
# plot(incidence(as.Date(viruela_curva$fis), groups = viruela_curva$clasificacion_final_del_caso, first_date = "2022-07-10", last_date = "2023-02-28", interval = 7), border = "black")+ theme_classic()+
#   coord_cartesian(ylim = c(0,7))+ labs(title = "Curva epidemica casos viruela simica", x = "Fecha inicio de sintomas", y = "Casos")+ scale_x_date(date_breaks = "7 day", date_labels = "%d %b %y")+
#   theme(legend.position = "bottom", axis.text.x = element_text(angle = 45, size = 6))
```



```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.cap="Comportamiento inusuales en los eventos de interes en salud pública en el municipio de Pereira, Pereira 2025"}
promedios <- readRDS("/cloud/project/Boletin_ Epi_Pereira/Datos/promedios.rds")
actual <- as.data.frame(table(casos2022$cod_eve, casos2022$semana)) %>% 
  rename(evento = "Var1", semana = "Var2") %>% 
  mutate(evento = as.character(evento), semana = as.numeric(semana)) %>% 
    pivot_wider(id_cols = "evento", names_from = "semana", values_from = "Freq")

poisson <- actual %>% 
  select(1, Observado = epiweek+1) %>% 
  left_join(promedios %>% select(1,2, Esperado = epiweek+2), by = "evento") %>% 
  relocate(evento, nom_eve, Esperado, Observado) %>% 
  mutate(`valor p` = round(dpois(x = Observado, lambda = Esperado), 2)) %>% 
  mutate(nom_eve = str_to_sentence(nom_eve))

export(poisson,"/cloud/project/Boletin_ Epi_Pereira/Datos/poisson.xlsx")

poisson %>% 
  flextable() %>% 
  flextable::bg(j = 5, i = ~ `valor p`< 0.05, part = "body", bg = "#E76B2F") %>% 
  flextable::align(j = c(3:5), align = "center", part = "all") %>% 
  set_header_labels(evento = "Codigo SIVIGILA", nom_eve = "Evento") %>% 
  width(j = 2, width = 7, unit = "cm") %>% 
  set_caption(paste("Comportamientos inusuales para los eventos de interes en salud pública notificados, semana epidemiologica",epiweek,", Pereira 2024"))

```

\newpage

***Jorge Mario Estrada-Alvarez MSc. Epi***

Coordiandor Epidemiologia y Gestion de Conocimiento

***Maryluz Hincapie-Acuña MSc. Epi***

Epidemiologa

***Viviana Trujillo***

Enfermera - SIVIGILA

***Angela Monsalve Esp. Epi***

Epidemiologa

***Angela Maria Rincon Msc Epi. PhD***

Epidemiologa

**Alcaldia de Pereira**

**Secretaria de Salud Pública y Seguridad Social**
